<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>New</title>

    <link rel="stylesheet" href="stylesheets/new.css">
    <link rel="stylesheet" href="lib/katex/katex.min.css">

    <script src="lib/katex/katex.min.js"></script>
    <script src="lib/d3/d3.min.js"></script>

</head>
<body>

<h1>
    <a class="tag-left" href="#">#</a>
    This is a header
</h1>

<aside>
    This is some text in an aside.
</aside>

<p>
    This is some text and it is really long so that hopefully it will need to be wrapped to the next line. \(\partial /\partial t\) This is some text and it is really long so that hopefully it will need to be wrapped to the next \(\partial /\partial t\) line.
</p>

<h2>
    <a class="tag-left" href="#">#</a>
    This is a smaller header
</h2>

<aside>
    Another aside.
</aside>

<p>
    This is some text and it is really long so that hopefully it will need to be wrapped to the next line. <a class="tag-left" href="#">#</a>This is some text and it is really long so that hopefully it will need to be wrapped to the next line.
</p>


<div class="equation" data-tag="1">
    \frac{\partial}{\partial t} = \frac{\partial}{\partial t}
    \frac{\partial}{\partial t} = \frac{\partial}{\partial t}
</div>

<p>
    This is some text and it is really long so that hopefully it will need to be wrapped to the next line. <a class="tag-left" href="#">#</a>This is some text and it is really long so that hopefully it will need to be wrapped to the next line.
</p>

<script>

    d3.selectAll('.equation')
        .each(render_block);

    d3.selectAll('p')
        .each(render_inline);

    function render_block () {

        var div = d3.select(this);
        var tag = div.attr('data-tag');
        var text = div.text().trim().replace('\n', ' \\\\ ');
        var block = '\\begin{aligned}' + text + '\\end{aligned}';
        katex.render(block, div.node(), { displayMode: true });
        if (tag) {
            div.insert('div', ':first-child')
                .classed('eq-tag', true)
                .text(tag);
        }

    }

    function render_inline () {

        var selection = d3.select(this);
        var text = selection.html();
        var regex = /\\\((.*?)\\\)/g;

        text = text.replace(regex, function (something) {
            return katex.renderToString(something.slice(2, -2));
        });

        selection.html(text);

    }

</script>

</body>
</html>